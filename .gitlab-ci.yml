image: openjdk:17-jdk-slim

before_script:
  - apt-get update -qq
  - apt-get install -y -qq wget unzip
  # Download Android SDK
  - wget -q https://dl.google.com/android/repository/commandlinetools-linux-11076708_latest.zip -O android-sdk.zip
  - unzip -q android-sdk.zip -d $PWD/android-sdk
  - rm android-sdk.zip
  - export ANDROID_SDK_ROOT=$PWD/android-sdk
  - export PATH=$PATH:$ANDROID_SDK_ROOT/cmdline-tools/bin
  # Accept licenses
  - yes | sdkmanager --licenses > /dev/null 2>&1 || true
  # Install build tools
  - sdkmanager "build-tools;34.0.0" "platforms;android-34" > /dev/null 2>&1

build:
  stage: build
  script:
    - chmod +x gradlew
    - ./gradlew assembleDebug --stacktrace
  artifacts:
    paths:
      - app/build/outputs/apk/debug/app-debug.apk
    expire_in: 1 week
  only:
    - main
